<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TanLoc</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent-a:#6f2bdc;
      --accent-b:#2dd4ff;
      --glass-bg:rgba(255,255,255,0.05);
      --glass-border:rgba(255,255,255,0.15);
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body {
      font-family: Poppins, system-ui, sans-serif;
      background: url("https://i.pinimg.com/originals/a6/c5/dc/a6c5dc5ff0620933cf6a7e76fec0e0b2.jpg") no-repeat center center fixed;
      background-size: cover;
      color: #eaf6ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 28px;
    }
    .container {width:100%;max-width:860px;z-index:1;display:flex;flex-direction:column;gap:24px;}

    /* avatar */
    .avatar {display:flex;justify-content:center}
    .avatar img {
      width:90px;height:90px;border-radius:50%;
      border:3px solid rgba(255,255,255,0.25);
      box-shadow:0 6px 20px rgba(0,0,0,0.5);
    }

    /* panel */
    .panel {
      padding:22px;
      border-radius:18px;
      background:var(--glass-bg);
      backdrop-filter: blur(16px);
      border:1px solid var(--glass-border);
      box-shadow:0 8px 28px rgba(0,0,0,0.6),0 0 20px rgba(111,43,220,0.35);
      animation: fadeIn .5s ease;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
    .title {
      text-align:center;
      font-weight:700;
      margin-bottom:18px;
      color:#dce9f9;
      font-size:19px;
      letter-spacing:.5px;
    }

    /* exec buttons - CHỈNH SỬA THÀNH DỌC */
    .exec-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .exec-btn {
      padding: 16px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 15px;
      text-align: center;
      color: #fff;
      text-decoration: none;
      transition: all .3s ease;
      box-shadow: 0 6px 14px rgba(0,0,0,0.3);
      display: block;
      width: 100%;
    }
    .exec-btn:hover {transform: translateY(-4px) scale(1.02);}
    .delta {background:linear-gradient(135deg,#3b82f6,#6f2bdc)}
    .codex {background:linear-gradient(135deg,#7c3aed,#22d3ee)}
    .ronix {background:linear-gradient(135deg,#0ea5e9,#7c3aed)}
    .krnl  {background:linear-gradient(135deg,#1e293b,#0ea5e9)}

    /* popup overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .popup {
      background: var(--glass-bg);
      padding: 22px;
      border-radius: 16px;
      backdrop-filter: blur(18px);
      border:2px solid #3b82f6;   /* viền xanh */
      box-shadow: 0 0 15px rgba(59,130,246,0.7), 0 8px 25px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      gap: 14px;
      min-width: 280px;
      text-align: center;
      animation: scaleIn .35s ease;
    }
    @keyframes scaleIn {from{opacity:0;transform:scale(.85)}to{opacity:1;transform:scale(1)}}
    .popup h3 {font-size: 16px; color: #fff;}

    /* scripts */
    .scripts {display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;}
    .script-card {
      background:var(--glass-bg);
      border:1px solid var(--glass-border);
      border-radius:14px;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      box-shadow:0 6px 18px rgba(0,0,0,0.35);
      transition: transform .25s ease,box-shadow .25s ease;
    }
    .script-card:hover {transform: translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,0.45);}
    .script-title {font-weight:600;font-size:15px;color:#fff}
    .script-desc {font-size:12px;color:#b7c7da}
    .btn-row {display:flex;gap:10px;}
    .copy-btn {
      flex:1;
      padding:10px 14px;
      border:0;
      border-radius:8px;
      cursor:pointer;
      background:linear-gradient(135deg,var(--accent-a),var(--accent-b));
      font-weight:600;
      font-size:14px;
      color:#031220;
      transition:all .3s ease;
    }
    .copy-btn:hover {transform:scale(1.05)}
    .delete-btn {background:#ef4444;color:#fff;}

    /* admin */
    .admin-btn {
      position: fixed;bottom: 22px;right: 22px;
      background: linear-gradient(135deg,#6f2bdc,#2dd4ff);
      color: #031220;font-weight: 700;font-size: 18px;
      border: 0;border-radius: 50%;width: 58px;height: 58px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
      cursor: pointer;z-index: 9999;
      display:flex;align-items:center;justify-content:center;
      transition:.3s ease;
    }
    .admin-btn:hover {transform: scale(1.1);}
    .admin-panel {
      position: fixed;bottom: 90px;right: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 14px;padding: 18px;
      display: none;flex-direction: column;gap: 14px;
      width: 300px;max-height: 70vh;overflow-y: auto;
      z-index: 9998;
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
      backdrop-filter: blur(16px);
    }
    .admin-panel input,.admin-panel textarea {
      width:100%;padding:8px;
      border-radius:6px;border:1px solid rgba(255,255,255,0.2);
      background:#11182b;color:#fff;font-size:13px;
    }
    .admin-panel h4{color:#9cc7ff;font-size:14px;font-weight:600}
    .admin-panel button{
      padding:10px;border-radius:8px;border:0;
      background:linear-gradient(135deg,var(--accent-a),var(--accent-b));
      font-weight:600;color:#031220;cursor:pointer;
    }
    
    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 14px 28px;
      border-radius: 10px;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-10px);
    }
    .toast.success {
      background: rgba(16, 185, 129, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .toast.error {
      background: rgba(239, 68, 68, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .toast.warning {
      background: rgba(245, 158, 11, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .toast.info {
      background: rgba(59, 130, 246, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Confirm dialog */
    .confirm-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      backdrop-filter: blur(5px);
    }
    .confirm-content {
      background: var(--glass-bg);
      padding: 24px;
      border-radius: 16px;
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      max-width: 350px;
      text-align: center;
    }
    .confirm-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      justify-content: center;
    }
    .confirm-buttons button {
      padding: 8px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    .confirm-yes {
      background: var(--error);
      color: white;
    }
    .confirm-no {
      background: var(--success);
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="avatar"><img src="https://i.pinimg.com/originals/82/9b/74/829b74c0e393c4c47907f2dfffc64fc2.gif" alt="Avatar"></div>

    <!-- clients -->
    <div class="panel">
      <div class="title">Executor</div>
      <div class="exec-list">
        <a href="javascript:void(0)" class="exec-btn delta" onclick="openPopup('delta-popup')">Delta X</a>
        <a href="javascript:void(0)" class="exec-btn codex" onclick="openPopup('codex-popup')">Codex</a>
        <a href="javascript:void(0)" class="exec-btn ronix" onclick="openPopup('ronix-popup')">Ronix</a>
        <a href="javascript:void(0)" class="exec-btn krnl" onclick="openPopup('krnl-popup')">KRNL</a>
      </div>
    </div>

    <!-- scripts -->
    <div class="panel">
      <div class="title">SCRIPTS</div>
      <div class="scripts" id="script-list"></div>
    </div>
  </div>

  <!-- popups -->
  <div class="overlay" id="delta-popup" onclick="closeOverlay(event,'delta-popup')">
    <div class="popup">
      <h3>Delta</h3>
      <a id="delta-global" href="#" class="exec-btn delta" download>Delta Global</a>
      <a id="delta-vng" href="#" class="exec-btn delta" download>Delta VNG</a>
    </div>
  </div>
  <div class="overlay" id="codex-popup" onclick="closeOverlay(event,'codex-popup')">
    <div class="popup">
      <h3>Codex</h3>
      <a id="codex-global" href="#" class="exec-btn codex" download>Codex Global</a>
      <a id="codex-vng" href="#" class="exec-btn codex" download>Codex VNG</a>
    </div>
  </div>
  <div class="overlay" id="ronix-popup" onclick="closeOverlay(event,'ronix-popup')">
    <div class="popup">
      <h3>Ronix</h3>
      <a id="ronix-global" href="#" class="exec-btn ronix" download>Ronix Global</a>
      <a id="ronix-vng" href="#" class="exec-btn ronix" download>Ronix VNG</a>
    </div>
  </div>
  <div class="overlay" id="krnl-popup" onclick="closeOverlay(event,'krnl-popup')">
    <div class="popup">
      <h3>KRNL</h3>
      <a id="krnl-global" href="#" class="exec-btn krnl" download>KRNL Global</a>
      <a id="krnl-vng" href="#" class="exec-btn krnl" download>KRNL VNG</a>
    </div>
  </div>

  <!-- Toast notification -->
  <div class="toast" id="toast"></div>

  <!-- Confirm dialog -->
  <div class="confirm-dialog" id="confirm-dialog">
    <div class="confirm-content">
      <h3 id="confirm-message">Bạn có chắc muốn xóa script này?</h3>
      <div class="confirm-buttons">
        <button class="confirm-yes" id="confirm-yes">Có</button>
        <button class="confirm-no" id="confirm-no">Không</button>
      </div>
    </div>
  </div>

  <!-- admin -->
  <button class="admin-btn" onclick="openAdmin()">⚙</button>
  <div class="admin-panel" id="admin-panel">
    <input type="password" id="admin-pass" placeholder="Nhập mật khẩu">
    <button onclick="checkPass()">Login</button>
    <div id="admin-content" style="display:none">
      <h4>Cập nhật link client</h4>
      <input id="link-delta-global" placeholder="Delta Global link">
      <input id="link-delta-vng" placeholder="Delta VNG link">
      <input id="link-codex-global" placeholder="Codex Global link">
      <input id="link-codex-vng" placeholder="Codex VNG link">
      <input id="link-ronix-global" placeholder="Ronix Global link">
      <input id="link-ronix-vng" placeholder="Ronix VNG link">
      <input id="link-krnl-global" placeholder="KRNL Global link">
      <input id="link-krnl-vng" placeholder="KRNL VNG link">
      <button onclick="updateLinks()">Lưu link</button>

      <h4>Thêm script</h4>
      <input id="script-name" placeholder="Tên script">
      <input id="script-desc" placeholder="Mô tả script">
      <textarea id="script-code" rows="3" placeholder="Code script"></textarea>
      <button onclick="addScript()">Thêm script</button>
    </div>
  </div>

  <script>
    const BIN_ID = "68cea7b443b1c97be9494d4d";
    const API_KEY = "$2a$10$4wv3SZr7FOegcPB2LBHuUObqAHVOVY0Xp/1HxhHP0BWfnXGvslZKa";
    const BASE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    let isAdmin = false;
    let currentDeleteIndex = null;

    // Hàm hiển thị thông báo toast
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Hàm hiển thị dialog xác nhận
    function showConfirm(message, callback) {
      const dialog = document.getElementById('confirm-dialog');
      document.getElementById('confirm-message').textContent = message;
      dialog.style.display = 'flex';
      
      document.getElementById('confirm-yes').onclick = function() {
        dialog.style.display = 'none';
        callback(true);
      };
      
      document.getElementById('confirm-no').onclick = function() {
        dialog.style.display = 'none';
        callback(false);
      };
    }

    async function fetchData(){
      try {
        let res = await fetch(BASE_URL, { headers: { "X-Master-Key": API_KEY }});
        let data = await res.json();
        return data.record || {};
      } catch (e) {
        console.error("Error fetching data:", e);
        showToast("❌ Lỗi kết nối khi tải dữ liệu", "error");
        return {};
      }
    }
    
    async function saveData(record){
      try {
        await fetch(BASE_URL, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": API_KEY
          },
          body: JSON.stringify(record)
        });
        return true;
      } catch (e) {
        console.error("Error saving data:", e);
        showToast("❌ Lỗi khi lưu dữ liệu", "error");
        return false;
      }
    }

    function openPopup(id){document.getElementById(id).style.display="flex";}
    function closeOverlay(e,id){if(e.target.classList.contains('overlay')){document.getElementById(id).style.display="none";}}

    function openAdmin(){
      let p=document.getElementById("admin-panel");
      p.style.display=p.style.display==="flex"?"none":"flex";
    }
    
    function checkPass(){
      if(document.getElementById("admin-pass").value==="1153021372365275216"){
        isAdmin = true;
        document.getElementById("admin-pass").style.display="none";
        document.querySelector("#admin-panel button").style.display="none";
        document.getElementById("admin-content").style.display="block";
        loadData();
        showToast("✅ Đăng nhập admin thành công", "success");
      } else {
        showToast("❌ Sai mật khẩu!", "error");
      }
    }

    async function updateLinks(){
      let r = await fetchData();
      r.links = {
        delta_global: document.getElementById("link-delta-global").value,
        delta_vng: document.getElementById("link-delta-vng").value,
        codex_global: document.getElementById("link-codex-global").value,
        codex_vng: document.getElementById("link-codex-vng").value,
        ronix_global: document.getElementById("link-ronix-global").value,
        ronix_vng: document.getElementById("link-ronix-vng").value,
        krnl_global: document.getElementById("link-krnl-global").value,
        krnl_vng: document.getElementById("link-krnl-vng").value,
      };
      const success = await saveData(r);
      if (success) {
        loadData();
        showToast("✅ Đã lưu link thành công", "success");
      }
    }

    async function addScript(){
      let name=document.getElementById("script-name").value.trim();
      let desc=document.getElementById("script-desc").value.trim();
      let code=document.getElementById("script-code").value;
      if(!name||!code){
        showToast("⚠️ Vui lòng điền đủ thông tin!", "warning");
        return;
      }
      
      let r=await fetchData();
      if(!r.scripts) r.scripts = [];
      r.scripts.push({name,desc,code});
      
      const success = await saveData(r);
      if (success) {
        loadData();
        showToast("✅ Đã thêm script thành công", "success");
        
        // Clear form
        document.getElementById("script-name").value = "";
        document.getElementById("script-desc").value = "";
        document.getElementById("script-code").value = "";
      }
    }

    async function deleteScript(index){
      showConfirm("Bạn có chắc muốn xóa script này?", async function(confirmed) {
        if (!confirmed) return;
        
        let r = await fetchData();
        if(r.scripts && r.scripts.length > index){
          r.scripts.splice(index,1);
          const success = await saveData(r);
          if (success) {
            loadData();
            showToast("✅ Đã xóa script thành công", "success");
          }
        }
      });
    }

    function escapeHtml(str) {
      return String(str || "").replace(/[&<>"']/g, function(m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    function renderScripts(scripts){
      let list=document.getElementById("script-list");
      list.innerHTML="";
      
      if (!scripts || scripts.length === 0) {
        list.innerHTML = '<div class="script-card"><div class="script-desc" style="text-align:center">Chưa có script nào. Đăng nhập admin để thêm script.</div></div>';
        return;
      }
      
      scripts.forEach((s,i)=>{
        let card=document.createElement("div");
        card.className="script-card";
        card.innerHTML=`
          <div class="script-title">${escapeHtml(s.name)}</div>
          <div class="script-desc">${escapeHtml(s.desc||"Không có mô tả")}</div>
          <div class="btn-row">
            <button class="copy-btn">Copy</button>
            ${isAdmin?'<button class="delete-btn">Xóa</button>':""}
          </div>`;
        
        let copyBtn=card.querySelector(".copy-btn");
        copyBtn.onclick=function(){
          navigator.clipboard.writeText(s.code||"").then(() => {
            showToast("✅ Script đã được sao chép vào clipboard!", "success");
          }).catch(err => {
            console.error("Copy failed:", err);
            showToast("❌ Sao chép thất bại. Hãy thử thủ công.", "error");
          });
        };
        
        if(isAdmin){
          let delBtn=card.querySelector(".delete-btn");
          delBtn.onclick=function(){deleteScript(i)};
        }
        
        list.appendChild(card);
      });
    }

    async function loadData(){
      let r = await fetchData();
      
      // Update links
      if(r.links){
        document.getElementById("delta-global").href=r.links.delta_global||"#";
        document.getElementById("delta-vng").href=r.links.delta_vng||"#";
        document.getElementById("codex-global").href=r.links.codex_global||"#";
        document.getElementById("codex-vng").href=r.links.codex_vng||"#";
        document.getElementById("ronix-global").href=r.links.ronix_global||"#";
        document.getElementById("ronix-vng").href=r.links.ronix_vng||"#";
        document.getElementById("krnl-global").href=r.links.krnl_global||"#";
        document.getElementById("krnl-vng").href=r.links.krnl_vng||"#";
        
        // Prefill admin inputs if admin
        if(isAdmin){
          document.getElementById("link-delta-global").value = r.links.delta_global || "";
          document.getElementById("link-delta-vng").value = r.links.delta_vng || "";
          document.getElementById("link-codex-global").value = r.links.codex_global || "";
          document.getElementById("link-codex-vng").value = r.links.codex_vng || "";
          document.getElementById("link-ronix-global").value = r.links.ronix_global || "";
          document.getElementById("link-ronix-vng").value = r.links.ronix_vng || "";
          document.getElementById("link-krnl-global").value = r.links.krnl_global || "";
          document.getElementById("link-krnl-vng").value = r.links.krnl_vng || "";
        }
      }
      
      // Render scripts
      if(r.scripts){
        renderScripts(r.scripts);
      } else {
        renderScripts([]);
      }
    }
    
    // Initialize
    loadData();
  </script>
</body>
</html>
